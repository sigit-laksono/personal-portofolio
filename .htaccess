# Apache Configuration for Browser Caching and Security Headers
# Use this file if hosting on Apache server (not needed for AWS Amplify)

# Enable Rewrite Engine
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
</IfModule>

# ----------------------------------------------------------------------
# | Browser Caching                                                    |
# ----------------------------------------------------------------------

<IfModule mod_expires.c>
  ExpiresActive on
  ExpiresDefault                                      "access plus 1 month"

  # HTML - No caching for dynamic content
  ExpiresByType text/html                             "access plus 0 seconds"

  # CSS and JavaScript - Cache for 1 year
  ExpiresByType text/css                              "access plus 1 year"
  ExpiresByType application/javascript                "access plus 1 year"
  ExpiresByType text/javascript                       "access plus 1 year"

  # Images - Cache for 1 year
  ExpiresByType image/jpeg                            "access plus 1 year"
  ExpiresByType image/jpg                             "access plus 1 year"
  ExpiresByType image/png                             "access plus 1 year"
  ExpiresByType image/gif                             "access plus 1 year"
  ExpiresByType image/webp                            "access plus 1 year"
  ExpiresByType image/svg+xml                         "access plus 1 year"
  ExpiresByType image/x-icon                          "access plus 1 year"

  # Fonts - Cache for 1 year
  ExpiresByType font/woff                             "access plus 1 year"
  ExpiresByType font/woff2                            "access plus 1 year"
  ExpiresByType application/font-woff                 "access plus 1 year"
  ExpiresByType application/font-woff2                "access plus 1 year"
  ExpiresByType application/vnd.ms-fontobject         "access plus 1 year"
  ExpiresByType application/x-font-ttf                "access plus 1 year"
  ExpiresByType application/x-font-opentype           "access plus 1 year"

  # Other
  ExpiresByType application/pdf                       "access plus 1 month"
  ExpiresByType application/json                      "access plus 0 seconds"
</IfModule>

# ----------------------------------------------------------------------
# | Cache-Control Headers                                              |
# ----------------------------------------------------------------------

<IfModule mod_headers.c>
  # HTML - No cache
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "public, max-age=0, must-revalidate"
  </FilesMatch>

  # CSS and JavaScript - Cache for 1 year with immutable
  <FilesMatch "\.(css|js)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # Images - Cache for 1 year with immutable
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # Fonts - Cache for 1 year with immutable
  <FilesMatch "\.(woff|woff2|ttf|eot|otf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>

# ----------------------------------------------------------------------
# | Security Headers                                                   |
# ----------------------------------------------------------------------

<IfModule mod_headers.c>
  # Prevent MIME type sniffing
  Header set X-Content-Type-Options "nosniff"

  # Prevent clickjacking
  Header set X-Frame-Options "DENY"

  # Enable XSS protection
  Header set X-XSS-Protection "1; mode=block"

  # Referrer Policy
  Header set Referrer-Policy "strict-origin-when-cross-origin"

  # Remove X-Powered-By header
  Header unset X-Powered-By
</IfModule>

# ----------------------------------------------------------------------
# | Compression                                                        |
# ----------------------------------------------------------------------

<IfModule mod_deflate.c>
  # Compress HTML, CSS, JavaScript, Text, XML and fonts
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml

  # Remove browser bugs (only needed for really old browsers)
  BrowserMatch ^Mozilla/4 gzip-only-text/html
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
  Header append Vary User-Agent
</IfModule>

# ----------------------------------------------------------------------
# | ETags                                                              |
# ----------------------------------------------------------------------

# Remove ETags as resources are sent with far-future expires headers
<IfModule mod_headers.c>
  Header unset ETag
</IfModule>
FileETag None

# ----------------------------------------------------------------------
# | UTF-8 Encoding                                                     |
# ----------------------------------------------------------------------

# Use UTF-8 encoding for anything served as text/plain or text/html
AddDefaultCharset utf-8

# Force UTF-8 for certain file formats
<IfModule mod_mime.c>
  AddCharset utf-8 .atom .css .js .json .rss .vtt .webapp .xml
</IfModule>
